<!DOCTYPE html><html><head><title>Personal Website</title><meta name="twitter:title" content="Personal Website"/><meta name="og:title" content="Personal Website"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" type="text/css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" type="text/css"/><link rel="stylesheet" href="https://crelies.github.io/christianelies.de/styles.css" type="text/css"/><meta charset="UTF-8"/></head><body><header><div class="text-center pt-4 fs-12"><a class="text-danger text-monospace" href="https://crelies.github.io/christianelies.de"><p class="mb-0">debugPrint("Hello world!")</p></a></div><nav class="navbar navbar-expand-lg navbar-dark bg-dark justify-content-center"><div class="navbar-nav"><a class="nav-item nav-link fs-18" href="https://crelies.github.io/christianelies.de/me">.me</a><a class="nav-item nav-link active fs-18" href="https://crelies.github.io/christianelies.de/posts">.posts</a><a class="nav-item nav-link fs-18" href="https://crelies.github.io/christianelies.de/projects">.projects</a></div></nav><ul class="list-inline text-center pb-4 mb-0"><li class="list-inline-item"><a class="text-danger" target="_blank" href="https://github.com/crelies"><i class="fab fa-github fs-14"></i></a></li><li class="list-inline-item"><a class="text-danger" target="_blank" href="https://medium.com/@crelies"><i class="fab fa-medium fs-14"></i></a></li><li class="list-inline-item"><a class="text-danger" target="_blank" href="https://stackoverflow.com/story/crelies"><i class="fab fa-stack-overflow fs-14"></i></a></li><li class="list-inline-item"><a class="text-danger" target="_blank" href="https://www.xing.com/profile/Christian_Elies2"><i class="fab fa-xing fs-14"></i></a></li><li class="list-inline-item"><a class="text-danger" target="_blank" href="https://www.linkedin.com/in/christian-elies-b1009b104"><i class="fab fa-linkedin fs-14"></i></a></li></ul></header><div class="page-wrapper text-white"><h1>Meet &amp; Greet — Advanced Lists in SwiftUI</h1><a href="https://crelies.github.io/christianelies.de/tags/lists"><span class="badge badge-pill badge-success fs-12 text-monospace pt-2 pb-2 mr-2 mb-2">lists</span></a><a href="https://crelies.github.io/christianelies.de/tags/swiftui"><span class="badge badge-pill badge-info fs-12 text-monospace pt-2 pb-2 mr-2 mb-2">swiftui</span></a><p class="text-danger">14. Jul 2019</p><img src="advanced-lists-header.png" alt="List image (Copyright © 2019 <strong>Christian Elies</strong>)"/><p><em>List image (Copyright © 2019 <strong>Christian Elies</strong>)</em></p><p><strong>Update 2019/08/14:</strong> Now available as a <a href="https://github.com/crelies/AdvancedList">Swift package</a> 🚀</p><h2>Motivation</h2><p>What do I mean by <em>advanced list</em>?</p><p>The app I’m currently working on has many dynamic lists which can represent different states, such as <code>empty</code>, <code>error</code>, <code>items</code> or <code>loading</code>.</p><p>I implemented a solution, on top of the data-driven framework <a href="https://github.com/Instagram/IGListKit">IGListKit</a>, to be able to create these type of lists in our <a href="https://getuikit.com/">UIKit</a> app.</p><p>Now, I wanted to implement something similar using <a href="https://developer.apple.com/xcode/swiftui/">SwiftUI</a>. Just a few lines of code, right?</p><h2>Implementation</h2><p>In this section, we will take a look at my implementation and the different components I created.</p><h3>ListState</h3><p>The <code>AdvancedList</code> should be able to represent different states. We can easily define the states with an <code>Enum</code>.</p><p>You will see below why I skipped adding an empty case.</p><pre><code><span class="keyword">enum</span> ListState {
    <span class="keyword">case</span> error(<span class="keyword">_</span> error: <span class="type">Error</span>?)
    <span class="keyword">case</span> items
    <span class="keyword">case</span> loading
}
<span class="keyword">extension</span> <span class="type">ListState</span> {
    <span class="keyword">var</span> error: <span class="type">Error</span>? {
        <span class="keyword">switch self</span> {
            <span class="keyword">case</span> .<span class="dotAccess">error</span>(<span class="keyword">let</span> error):
                <span class="keyword">return</span> error
            <span class="keyword">default</span>:
                <span class="keyword">return nil</span>
        }
    }
}
</code></pre><h3>ListService</h3><p>The <code>AdvancedList</code> needs a component which stores and manages the <code>ListState</code> and the <code>items</code>.</p><p>With <code>Combine</code> and the data binding feature of SwiftUI, we connect <code>AdvancedList</code> and <code>ListService</code>.</p><p>You can change the list state and modify the items through the <code>ListService</code> and the <code>AdvancedList</code> gets updated automatically.</p><pre><code><span class="keyword">final class</span> ListService: <span class="type">BindableObject</span> {
    <span class="keyword">private(set) var</span> items: [<span class="type">AnyListItem</span>] = [] {
        <span class="keyword">didSet</span> {
            didChange.<span class="call">send</span>()
        }
    }
    
    <span class="keyword">private(set) var</span> didChange = <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()
    
    <span class="keyword">var</span> listState: <span class="type">ListState</span> = .<span class="call">items</span> {
        <span class="keyword">didSet</span> {
            didChange.<span class="call">send</span>()
        }
    }
    
    <span class="keyword">func</span> appendItems&lt;Item: <span class="type">Identifiable</span>&gt;(<span class="keyword">_</span> items: [<span class="type">Item</span>]) <span class="keyword">where</span> <span class="type">Item</span>: <span class="type">View</span> {
        <span class="keyword">let</span> anyListItems = items.<span class="call">map</span> { <span class="type">AnyListItem</span>(item: $0) }
        <span class="keyword">self</span>.<span class="property">items</span>.<span class="call">append</span>(contentsOf: anyListItems)
    }
    
    <span class="keyword">func</span> updateItems&lt;Item: <span class="type">Identifiable</span>&gt;(<span class="keyword">_</span> items: [<span class="type">Item</span>]) <span class="keyword">where</span> <span class="type">Item</span>: <span class="type">View</span> {
        <span class="keyword">let</span> anyListItems = items.<span class="call">map</span> { <span class="type">AnyListItem</span>(item: $0) }
        <span class="keyword">for</span> anyListItem <span class="keyword">in</span> anyListItems {
            <span class="keyword">guard let</span> itemIndex = <span class="keyword">self</span>.<span class="property">items</span>.<span class="call">firstIndex</span>(where: { $0.<span class="property">id</span> == anyListItem.<span class="property">id</span> }) <span class="keyword">else</span> {
                <span class="keyword">continue</span>
            }
            
            <span class="keyword">self</span>.<span class="property">items</span>[itemIndex] = anyListItem
        }
    }
    
    <span class="keyword">func</span> removeItems&lt;Item: <span class="type">Identifiable</span>&gt;(<span class="keyword">_</span> items: [<span class="type">Item</span>]) <span class="keyword">where</span> <span class="type">Item</span>: <span class="type">View</span> {
        <span class="keyword">let</span> anyListItemsToRemove = items.<span class="call">map</span> { <span class="type">AnyListItem</span>(item: $0) }
        <span class="keyword">self</span>.<span class="property">items</span>.<span class="call">removeAll</span>(where: { item <span class="keyword">in
             return</span> anyListItemsToRemove.<span class="call">contains</span> { item.<span class="property">id</span> == $0.<span class="property">id</span> }
        })
    }
    
    <span class="keyword">func</span> removeAllItems() {
        items.<span class="call">removeAll</span>()
    }
}
</code></pre><p>There are two special items in the implementation of <code>ListService</code>: <code>Item</code> and <code>AnyListItem</code>.</p><h3>Item</h3><p>We want to be able to show different items in the same list. Each item should be identifiable and should be representable as a SwiftUI view.</p><p>To achieve that, I constrained the <code>Item</code> to the <code>Identifiable</code> and the <code>View</code> protocol.</p><pre><code><span class="keyword">func</span> appendItems&lt;Item: <span class="type">Identifiable</span>&gt;(<span class="keyword">_</span> items: [<span class="type">Item</span>]) <span class="keyword">where</span> <span class="type">Item</span>: <span class="type">View</span> {}
</code></pre><p>But there is one problem.</p><p>We can’t store objects conforming to the <code>Identifiable</code> and to the <code>View</code> protocol in an array inside of the <code>ListService</code>, because the protocols have associated types and generic constraints. That’s why I have to use ‘type erasure’.</p><p>I implemented a box type called <code>AnyListItem</code> which erases the type information of the <code>body</code> property (required by <code>View</code>) using <code>AnyView</code> and of the <code>id</code> property (required by <code>Identifiable</code>) using <code>AnyHashable</code>.</p><pre><code><span class="keyword">struct</span> AnyListItem: <span class="type">Identifiable</span>, <span class="type">View</span> {
    <span class="keyword">let</span> id: <span class="type">AnyHashable</span>
    <span class="keyword">let</span> body: <span class="type">AnyView</span>
    
    <span class="keyword">init</span>&lt;<span class="type">Item</span>: <span class="type">Identifiable</span>&gt;(item: <span class="type">Item</span>) <span class="keyword">where</span> <span class="type">Item</span>: <span class="type">View</span> {
        id = item.<span class="property">id</span>
        body = <span class="type">AnyView</span>(item)
    }
}
</code></pre><p><code>ListService</code> uses <code>AnyListItem</code> internally to erase the type information of each <code>item</code> added to the list.</p><h3>AdvancedList</h3><p>Finally, let’s take a look at the implementation of the SwiftUI view <code>AdvancedList</code>.</p><p>The view renders itself dependent on the current list state and the current items. To do so, the <code>AdvancedList</code> view needs an instance of <code>ListService</code> which manages the list state and the items.</p><p>With the use of the <code>ObjectBinding</code> property wrapper on the <code>listService</code> variable, we tell the <code>AdvancedList</code> view to bind to the changes.</p><p>Additionally, a user of the <code>AdvancedList</code> view should be able to specify a view for the <code>empty</code>, <code>loading</code> and <code>error</code> state of the list.</p><p>I used the <code>ViewBuilder</code> property wrapper on the parameters in the initializer to achieve that.</p><pre><code><span class="keyword">struct</span> AdvancedList&lt;EmptyStateView: <span class="type">View</span>, ErrorStateView: <span class="type">View</span>, LoadingStateView: <span class="type">View</span>&gt; : <span class="type">View</span> {
    <span class="keyword">@ObjectBinding private var</span> listService: <span class="type">ListService</span>
    <span class="keyword">private let</span> emptyStateView: () -&gt; <span class="type">EmptyStateView</span>
    <span class="keyword">private let</span> errorStateView: (<span class="type">Error</span>?) -&gt; <span class="type">ErrorStateView</span>
    <span class="keyword">private let</span> loadingStateView: () -&gt; <span class="type">LoadingStateView</span>
    
    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="keyword">return</span> <span class="type">Group</span> {
            <span class="keyword">if</span> listService.<span class="property">listState</span>.<span class="property">error</span> != <span class="keyword">nil</span> {
                <span class="call">errorStateView</span>(listService.<span class="property">listState</span>.<span class="property">error</span>)
            } <span class="keyword">else if</span> listService.<span class="property">listState</span> == .<span class="dotAccess">items</span> {
                <span class="keyword">if</span> !listService.<span class="property">items</span>.<span class="property">isEmpty</span> {
                    <span class="type">List</span>(listService.<span class="property">items</span>.<span class="call">identified</span>(by: \.<span class="property">id</span>)) { item <span class="keyword">in</span>
                        item
                    }
                } <span class="keyword">else</span> {
                    <span class="call">emptyStateView</span>()
                }
            } <span class="keyword">else if</span> listService.<span class="property">listState</span> == .<span class="dotAccess">loading</span> {
                <span class="call">loadingStateView</span>()
            } <span class="keyword">else</span> {
                <span class="type">EmptyView</span>()
            }
        }
    }
    
    <span class="keyword">init</span>(listService: <span class="type">ListService</span>, <span class="keyword">@ViewBuilder</span> emptyStateView: <span class="keyword">@escaping</span> () -&gt; <span class="type">EmptyStateView</span>, <span class="keyword">@ViewBuilder</span> errorStateView: <span class="keyword">@escaping</span> (<span class="type">Error</span>?) -&gt; <span class="type">ErrorStateView</span>, <span class="keyword">@ViewBuilder</span> loadingStateView: <span class="keyword">@escaping</span> () -&gt; <span class="type">LoadingStateView</span>) {
        <span class="keyword">self</span>.<span class="property">listService</span> = listService
        <span class="keyword">self</span>.<span class="property">emptyStateView</span> = emptyStateView
        <span class="keyword">self</span>.<span class="property">errorStateView</span> = errorStateView
        <span class="keyword">self</span>.<span class="property">loadingStateView</span> = loadingStateView
    }
}
</code></pre><p>As I mentioned above, we don’t need an empty case on the <code>ListState</code> enum because we can use <code>isEmpty</code> on the <code>items</code>instead.</p><p>There is one more special thing in my implementation:</p><p>The <code>error</code> case of the <code>ListState</code> has an associated value of type <code>Error</code><em>.</em> That way I can pass the error to the error view which can display it if needed.</p><p>That’s it! Let’s see how we can use <code>AdvancedList</code> in the field.</p><h2>Example Usage</h2><p>In this section, you will see a simple usage example of the <code>AdvancedList</code> SwiftUI view.</p><p>Hint<strong>:</strong> You will find the complete implementation in the GitHub repository linked below.</p><p>First, we have to create the items we want to show on the list.</p><h3>Example items</h3><p>I created a <code>ContactListItem</code> representing a contact (name, address, etc.).</p><p>To add instances of this item to the list, it has to conform to the protocols <code>Identifiable</code> and <code>View</code>.</p><p>I did something special here; I want to be able to render this item differently, dependent on its type property.</p><p>Take a look at the usage of <code>viewRepresentationType</code> in the <code>body</code> property.</p><pre><code><span class="keyword">struct</span> ContactListItem: <span class="type">Identifiable</span> {
    <span class="keyword">@State private var</span> collapsed: <span class="type">Bool</span> = <span class="keyword">true
    
    let</span> id: <span class="type">String</span>
    <span class="keyword">let</span> firstName: <span class="type">String</span>
    <span class="keyword">let</span> lastName: <span class="type">String</span>
    <span class="keyword">let</span> streetAddress: <span class="type">String</span>
    <span class="keyword">let</span> zip: <span class="type">String</span>
    <span class="keyword">let</span> city: <span class="type">String</span>
    
    <span class="keyword">var</span> viewRepresentationType: <span class="type">ContactListItemViewRepresentationType</span> = .<span class="dotAccess">short</span>
}
<span class="keyword">extension</span> <span class="type">ContactListItem</span>: <span class="type">View</span> {
    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="type">Group</span> {
            <span class="keyword">if</span> viewRepresentationType == .<span class="dotAccess">short</span> {
                <span class="type">ContactListItemView</span>(firstName: firstName,
                                    lastName: lastName,
                                    hasMoreInformation: <span class="keyword">false</span>)
            } <span class="keyword">else if</span> viewRepresentationType == .<span class="dotAccess">detail</span> {
                <span class="type">NavigationLink</span>(destination: <span class="type">ContactDetailView</span>(listItem: <span class="keyword">self</span>), label: {
                    <span class="type">ContactListItemView</span>(firstName: firstName,
                                        lastName: lastName,
                                        hasMoreInformation: <span class="keyword">true</span>)
                })
            } <span class="keyword">else if</span> viewRepresentationType == .<span class="dotAccess">collapsable</span> {
                <span class="type">VStack</span> {
                    <span class="keyword">if</span> collapsed {
                        <span class="type">ContactListItemView</span>(firstName: firstName,
                                            lastName: lastName,
                                            hasMoreInformation: <span class="keyword">false</span>)
                    } <span class="keyword">else</span> {
                        <span class="type">ContactDetailView</span>(listItem: <span class="keyword">self</span>)
                    }
                    
                    <span class="type">Button</span>(action: {
                        <span class="keyword">self</span>.<span class="property">collapsed</span>.<span class="call">toggle</span>()
                    }) {
                        <span class="type">Text</span>(<span class="string">"</span>\(collapsed ? <span class="string">"show"</span> : <span class="string">"hide"</span>) <span class="string">details"</span>)
                    }.<span class="call">foregroundColor</span>(.<span class="dotAccess">blue</span>)
                }
            }
        }
    }
}
</code></pre><img src="advanced-lists-example.gif" alt="Animated image showing an AdvancedList with ContactItems on iPhone XR"/><p><em>Animated image showing an AdvancedList with ContactItems on iPhone XR</em></p><p>Additionally, I implemented a second item which represents a simple ad.</p><p>I did the same as with <code>ContactListItem</code>. The <code>AdListItem</code> has a type which controls the view definition.</p><pre><code><span class="keyword">struct</span> AdListItem: <span class="type">Identifiable</span> {
    <span class="keyword">@State private var</span> isImageCollapsed: <span class="type">Bool</span> = <span class="keyword">true
    
    let</span> id: <span class="type">String</span>
    <span class="keyword">let</span> text: <span class="type">String</span>
    <span class="keyword">var</span> viewRepresentationType: <span class="type">AdListItemViewRepresentationType</span> = .<span class="dotAccess">short</span>
}
<span class="keyword">extension</span> <span class="type">AdListItem</span>: <span class="type">View</span> {
    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="type">Group</span> {
            <span class="keyword">if</span> viewRepresentationType == .<span class="dotAccess">short</span> {
                <span class="type">NavigationLink</span>(destination: <span class="type">AdDetailView</span>(text: text), label: {
                    <span class="type">Text</span>(text)
                        .<span class="call">lineLimit</span>(<span class="number">1</span>)
                    <span class="type">Text</span>(<span class="string">"ℹ️"</span>)
                })
            } <span class="keyword">else if</span> viewRepresentationType == .<span class="dotAccess">long</span> {
                <span class="type">Text</span>(text)
                    .<span class="call">lineLimit</span>(<span class="keyword">nil</span>)
            } <span class="keyword">else if</span> viewRepresentationType == .<span class="dotAccess">image</span> {
                <span class="type">VStack</span> {
                    <span class="keyword">if</span> !isImageCollapsed {
                        <span class="type">Image</span>(<span class="string">"restaurant"</span>)
                            .<span class="call">resizable</span>()
                            .<span class="call">aspectRatio</span>(contentMode: .<span class="dotAccess">fit</span>)
                            .<span class="call">frame</span>(height: <span class="number">200</span>)
                    }
                    
                    <span class="type">Button</span>(action: {
                        <span class="keyword">self</span>.<span class="property">isImageCollapsed</span>.<span class="call">toggle</span>()
                    }) {
                        <span class="type">Text</span>(<span class="string">"</span>\(isImageCollapsed ? <span class="string">"show"</span> : <span class="string">"hide"</span>) <span class="string">image"</span>)
                    }.<span class="call">foregroundColor</span>(.<span class="dotAccess">blue</span>)
                }
            }
        }
    }
}
</code></pre><img src="advanced-lists-second-example.gif" alt="Animated image showing an AdvancedList with AdItems on iPhone XR"/><p><em>Animated image showing an AdvancedList with AdItems on iPhone XR</em></p><h3>Example content view</h3><p>Finally, we take a look at how to use the <code>AdvancedList</code> inside a simple content view.</p><p>You might be wondering what the <code>CustomListStateSegmentedControlView</code> is<strong>.</strong> It’s a helper view to easily change the list state and add random items to the list.</p><pre><code><span class="keyword">struct</span> ContentView : <span class="type">View</span> {
    <span class="keyword">@ObjectBinding private var</span> listService: <span class="type">ListService</span> = <span class="type">ListService</span>()
    
    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="type">NavigationView</span> {
            <span class="keyword">return</span> <span class="type">GeometryReader</span> { geometry <span class="keyword">in</span>
                <span class="type">VStack</span> {
                    <span class="type">CustomListStateSegmentedControlView</span>(listService: <span class="keyword">self</span>.<span class="property">listService</span>)
                    
                    <span class="type">AdvancedList</span>(listService: <span class="keyword">self</span>.<span class="property">listService</span>, emptyStateView: {
                        <span class="type">Text</span>(<span class="string">"No data"</span>)
                    }, errorStateView: { error <span class="keyword">in</span>
                        <span class="type">Text</span>(<span class="string">"</span>\(error?.<span class="property">localizedDescription</span> ?? <span class="string">"Error"</span>)<span class="string">"</span>).<span class="call">lineLimit</span>(<span class="keyword">nil</span>)
                    }, loadingStateView: {
                        <span class="type">Text</span>(<span class="string">"Loading ..."</span>)
                    })
                    .<span class="call">frame</span>(width: geometry.<span class="property">size</span>.<span class="property">width</span>)
                }
                .<span class="call">navigationBarTitle</span>(<span class="type">Text</span>(<span class="string">"List of Items"</span>))
            }
        }
    }
}
</code></pre><img src="advanced-lists-final.gif" alt="Animated image showing an AdvancedList with different items on iPhone XR"/><p><em>Animated image showing an AdvancedList with different items on iPhone XR</em></p><p>You’ve reached the end! Thank you very much for reading this article. I hope you liked my <code>AdvancedList</code> <code>view</code> and, of course, SwiftUI, as much as I do.</p><h2>Resources</h2><p>Here’s the code for this article:</p><p><a href="https://github.com/crelies/AdvancedList-SwiftUI"><strong>crelies/AdvancedList-SwiftUI</strong></a></p></div><footer class="mb-3"><div class="text-center fs-12 w-50 center-horizontally"><p class="text-danger text-monospace">    LegalNotice(name: "Christian Elies",
                city: "Lüneburg")<br/><br/>Copyright © Christian Elies 2020.<br/><p class="text-danger mb-0">Generated using <a target="_blank" class="text-danger text-decoration-underline" href="https://github.com/JohnSundell/Publish">Publish</a>. 100% JavaScript-free.</p></p></div></footer></body></html>